---
aliases:
- ELB
- ALB
- NLB
- GLB
- Transfer Family
- SQS
- SNS
- ECS
- EKS
- Fargate
- ECR
- Lambda
- API Gateway
- Step Functions
- CloudWatch
- EventBridge
- CloudTrail
- Config
---
# Elastic Load Balancer (ELB)
- servers that forward traffic to multiple servers downstream
![[Pasted image 20230818150222.png]]
- expose single point of access [[Technical Terms|DNS]]
- seamlessly handle failures downstream
- conduct health checks
- provide SSL termination for your websites
- enforce stickiness with cookies
- high availability across zones
- separate public traffic from private traffic
- AWS managed load balancer
- integrated with many AWS offerings
## Health Checks
- enable ELB to know is instances are available to forward traffic
- done on a port and a route
- response != 200 means the instance is unhealthy
![[Pasted image 20230818150718.png]]

## Security Groups
![[Pasted image 20230818150822.png]]
![[Pasted image 20230818150859.png]]

## Types
### Classic (CLB)
- HTTP & HTTPS (layer 7), TCP (layer 4), SSL (secure TCP)
- do not use
### Application (ALB)
- HTTP & HTTPS, WebSocket (layer 7)
- multiple HTTP apps across machines (target groups)
- multiple apps on the same machines (containers)
- supports redirects
- app servers don't see the IP of the client directly
	- true IP is inserted into the header **X-Forwarded-For**
![[Pasted image 20230818153319.png]]
#### Routing
- path in URL (example()com/**users** vs. example()com/**posts**)
	- has port mapping feature to redirect to a dynamic port in ECS
	- great fit for **micro services** & **container-based application** (Docker and ECS)
![[Pasted image 20230818152427.png]]
- hostname in URL (**one**.example.com vs. **other**.example.com)
- Query string, headers (example()com/**users?id=123&order=false**)
![[Pasted image 20230818153154.png]]
#### ALB Target Groups
- instances
- ECS tasks
- must be private IPs
### Network (NLB)
- [[Technical Terms|TCP]], TLS (secure TCP), [[Technical Terms|UDP]] (layer 4)
- forward this traffic to your instances
- millions of request per second
- less latency than ALB
- has **one static IP per AZ** and supports assigning [[Technical Terms|Elastic IP]]
- used for extreme performance, not included in free tier
![[Pasted image 20230818153709.png]]
#### NLB Target Groups
- instances
- must be private IPs
- **ALB**
- health checks support **TCP, HTTP, and HTTPS**
![[Pasted image 20230818153904.png]]
### Gateway
- operates at 3 layers (Network layer) - IP protocol (layer 3)
- deploy, scale, manage a fleet of 3rd party network virtual appliances in AWS
- ex. firewalls, intrusion detection, prevention systems, etc.
- combination of:
	- **Transparent Network Gateway**: single entry/exit for all traffic
	- **Load Balancer**
- **Uses GENEVE protocol on port 6081**
![[Pasted image 20230818154211.png]]
#### GLB Target Groups
- instances
- private IPs
## Sticky Sessions (Session Affinity)
- possible to implement stickiness so that the same client is always redirected to the same instance behind a load balancer
- does not work for GLB
- CLB and ALB use cookies
- may bring imbalance to the load over the backend EC2 instances 
### Application based Cookies
#### Custom
- generated by target
- custom attributes required by app
- name must be specified individually for each target group
- ***DON'T*** use **AWSALB, AWSALBAPP, AWSALBTG** (reserved for ELB)
#### Application
- generated by load balancer
- name is **AWSALBAPP**
### Duration based Cookies
- generated by load balancer
- name is **AWSALB** for ALB and **AWSELB** for CLB

## Cross-Zone Load Balancing
![[Pasted image 20230818155113.png]]
### ALB
- enabled by default (can be disabled at TG level)
- no charges for inter AZ data
### NLB & GLB
- disabled by default
- pay charges for inter AZ data if enabled
### CLB
- disabled by default
- no charges for inter AZ if enabled
## SSL Certificates
![[Pasted image 20230818155636.png]]
- uses X.509 certificate
- can manage certificates using ACM
- HTTPS listener:
	- must specify default certificate
	- can add multiple list of certs to support multiple domains
	- can use SNI to specify hostname they reach
	- able to specify a security policy to support older versions of SSL/TLS
### Server Name Indication (SNI)
- solves the problem of loading multiple SSL certs onto one web server (to server multiple websites)
- requires client to indicate the hostname of the target server and the initial SSL handshake
- only works for ALB, NLB and CloudFront
![[Pasted image 20230818160112.png]]
# Transfer Family
- fully managed service for file transfers into and out of [[Scalable storage solutions|S3]] or [[Scalable storage solutions|EFS]] using FTP, FTPS or SFTP
- managed, scalable, reliable, highly available
- pay per provisioned endpoint per hour + data transfers in GB
- store and manage user credentials
- integrate with existing authentication systems
![[Pasted image 20230825193714.png]]
# Standard Queue (SQS)
- fully managed used to decouple apps
- unlimited throughput, unlimited # of messages in queue
- low latency
- limit of 256KB per message
- can have dupes and out of order messages
## Producing Messages
- message is persisted until consumer deletes
- retained for 4-14 days
- ex. send order to be processed, order id, customer id, etc.
## Consuming Messages
- consumers: EC2, servers, Lambda
- poll for messages (receive up to 10 at one time)
- process messages
- delete messages
### EC2
- consumers receive and process messages in parallel
- at least once delivery
- best effort message ordering
- consumers delete messages after processing
- can scale out
![[Pasted image 20230825195157.png]]
## Security
### Encryption
- in flight using HTTPS
- at rest using KMS keys
- client side
### Access Controls
- [[Secure access to AWS resources|IAM]] policies to regulate access to the SQS API
### Access Policies
- useful for cross account access to SQS
- and allow other services (SNS, [[Scalable storage solutions|S3]]) to write an SQS queue
## Message Visibility Timeout
- after a message is polled, it becomes invisible to other consumers
- default 30s
- if message is not processed within visibility timeout, it will be processed twice
- consumer could call **ChangeMessageVisibility** API to get more time
![[Pasted image 20230825195530.png]]
## Long Polling
- when consumer requests messages, it can optionally wait for messages to arrive if there are none in the queue
- decreases number of API calls made to SQS while increasing the efficiency and reducing latency of your app
- between 1-20s
- can be enabled at queue level or API level
## FIFO Queue
- limited to 300 msg/s, batched 3000 msg/s
- exactly one send, removes dupes
- processed in order by consumer
- if load is too big, some transactions may be lost
# SNS
- send 1 message to many receivers
- event producer sends message to 1 SNS topic
- subscribers (event receivers) to each topic will get the messages
- up to 12.5 million subs per topic
- 100k topic limit
## How to Publish
### Topic Publish
- create topic
- create sub
- publish to topic
### Direct Publish
- create platform app
- create platform endpoint
- publish to platform endpoint
## Encryption
- in flight using HTTPS
- at rest using KMS keys
- client side
### Access Controls
- [[Secure access to AWS resources|IAM]] policies to regulate access to the SNS API
### Access Policies
- useful for cross account access to SNS
- and allow other services ([[Scalable storage solutions|S3]]) to write an SNS topic
## Message Filtering
- JSON policy used to filter messages sent to SNS topic's subs
- if a sub doesn't have a filter policy, it receives every message
![[Pasted image 20230825201115.png]]
# Fan out
- use SNS + SQS
- fully decoupled, no data loss
- SQS allows data persistence, delayed processing, and retries of work
- ability to add more SQS subs over time
- make sure SQS access policy allows for SNS to write
- cross-region delivery: works with SQS in other regions
- can only have SQS FIFO as a sub
![[Pasted image 20230825200838.png]]
![[Pasted image 20230825200901.png]]
# Elastic Container Service (ECS)
- container platform
- launch Docker containers = ECS tasks on ECS clusters
- can use [[Scalable and loosely coupled architectures|ALB]] and [[Scalable and loosely coupled architectures|NLB]]
## EC2 launch type
- must provision and maintain the instances
- each instance must run the ECS agent to register in the ECS cluster
![[Pasted image 20230825203945.png]]
## Fargate Launch Type
- serverless container platform, works with ECS and EKS
- do not need to provision, no instances to manage
- serverless
- just create task definitions
- can increase number of tasks to scale
## IAM Roles
### EC2 Instance Profile
- used by ECS agent
- makes API calls to CloudWatch Logs
- pull Docker Image from ECR
- reference sensitive data in Secrets Manager or SSM Parameter Store
### Task Role
- allow each task to have a specific role
- use different roles for different ECS services you run
- defined in the **task definition**
![[Pasted image 20230825204503.png]]
## Data Volumes (EFS)
- works on both launch types
- tasks running in any AZ will share the same data in the EFS file system
- Fargate + EFS = serverless
- useful for persistent multi AZ shared storage for your containers
- cannot use [[Scalable storage solutions|S3]]
## Service Auto Scaling
- auto increase/decrease # of tasks
- **Target Tracking**: scale based on target value for CloudWatch Metric
- **Step Scaling**: based on specified CloudWatch alarm
- **Scheduled Scaling**: based on specified data/time
### EC2 Instances
- accommodate by adding EC2 instances
#### ASG Scaling
- based on CPU utilization
- add instances over time
#### ECS Cluster Capacity Provider
- used to automatically provision and scale the infrastructure for ECS tasks
- paired with ASG
- add instances when missing capacity (CPU, RAM)
![[Pasted image 20230825205501.png]]

# Elastic Kubernetes Service (EKS)
- managed Kubernetes clusters
- Kubernetes is an open-source system for automatic deployment, scaling and management of containerized (usually Docker) application
- It’s an alternative to ECS, similar goal but different API
- supports EC2 and Fargate
- used for migration from on premises
![[Pasted image 20230825205856.png]]
## Node Types
### Managed
- creates and maanges Nodes (EC2 instances) for you
- Nodes are part of ASG managed by EKS
- supports on-demand or spot instances
### Self Managed
- created by you and managed by an ASG
- can use prebuilt AMI (EKS Optimized)
- supports on-demand or spot instances
### Fargate
- no maintenance, no Nodes managed
## Data Volumes
- [[Scalable storage solutions|EBS]]
- [[Scalable storage solutions|EFS]]
- [[Storage solutions|FSx]] Lsutre
- [[Storage solutions|FSx]] NetApp ONTAP
# Fargate

# Elastic Container Registry (ECR)
- store and manage docker images
- access controlled through [[Secure access to AWS resources|IAM]]
- supports image vulnerability scanning, versioning, image tags, image lifecycle, etc.
![[Pasted image 20230825205732.png]]
# Lambda
- virtual functions, no servers
- on demand
- scaling is automated
- Integrated with the whole AWS suite of services
- 10GB of RAM
- default is launched outside of [[Technical Terms|VPC]]
	- must define VPC ID, subnets and security groups
	- Lambda will create [[Scalable network architectures|ENI]] in your subnets
![[Pasted image 20230825212252.png]]
## Limits per region
### Execution
- Memory allocation: 128 MB – 10GB (1 MB increments)
- Maximum execution time: 900 seconds (15 minutes)
- Environment variables (4 KB)
- Disk capacity in the “function container” (in /tmp): 512 MB to 10GB
- Concurrency executions: 1000 (can be increased)
### Deployment
- Lambda function deployment size (compressed .zip): 50 MB
- Size of uncompressed deployment (code + dependencies): 250 MB
- Can use the /tmp directory to load other files at startup
- Size of environment variables: 4 KB
## Customization at the Edge
### Edge Function
- code to attach to CloudFront distributions
- runs close to users to minimize latency
- written in NodeJS or Python
- 1000s of requests per second
- used to **change** [[Scalable network architectures|CloudFront]] requests and responses
- author functions in 1 region
#### Uses
- Website Security and Privacy
- Dynamic Web Application at the Edge
- Search Engine Optimization (SEO)
- Intelligently Route Across Origins and Data Centers
- Bot Mitigation at the Edge
- Real-time Image Transformation
- A/B Testing
- User Authentication and Authorization
- User Prioritization
- User Tracking and Analytics
## RDS Proxy
- if it directly access the database, it may open too many connections under a high load
- this improves scalability by pooling and sharing DB connections
- improve scalability by pooling and sharing DB connections
- improve security by enforcing [[Secure access to AWS resources|IAM]]
- must be deployed in VPC since **RDS Proxy server is never publicly accessible**
## Invoking from RDS and Aurora
- process data events from within a database
- support for [[Database solutions|RDS]] for PostgreSQL and [[Database solutions|Aurora]] MySQL
- must allow outbound traffic to the functions from within the DB (Public, NAT GW, VPC Endpoint)
- DB must have required permissions to invoke the function (Lambda Resource based Policy and IAM policy)
# API Gateway
- serverless
- support for WebSocket protocol
- handle API versioning
- handle different environments
- security
- transform and validate requests and responses
- generate SDK and API specs
- cache API responses
- expose any AWS API
## Lambda
- easy way to expose REST API backed by [[Scalable and loosely coupled architectures|Lambda]]
## HTTP
- expose HTTP endpoints in the backend
- ex. internal HTTP API on premise, [[Scalable and loosely coupled architectures|ALB]]
## Endpoint Types
### Edge-Optimized (default)
- for global clients
- requests are routed through [[Scalable network architectures|CloudFront]] Edge locations
- gateway still lives in only 1 region
### Regional
- for clients within the same region
- could manually combine with [[Scalable network architectures|CloudFront]]
### Private
- can only access from your [[Technical Terms|VPC]] using interface VPC endpoint (ENI)
- use as resource policy to define access
## Security
### User Authentication 
- IAM Roles
- Cognito (external users)
- custom authorizer
### Custom Domain Name HTTPS
- through **ACM**
- if using Edge optimized, certificate must be in us-east-1
- if using regional, certificate must be in API gateway region
- must set up CNAME or A-alias in [[Highly available and fault tolerant architectures|Route 53]]
# Step Functions
- build serverless visual workflow to orchestrate [[Scalable and loosely coupled architectures|Lambda]] functions
- integrate with [[Scalable and loosely coupled architectures|ECS]], [[Scalable network architectures|EC2]], on premise servers, [[Scalable and loosely coupled architectures|API Gateway]], [[Scalable and loosely coupled architectures|SQS]], etc.
- can have human approval feature
- useful for order fulfilment, data processing, web apps
![[Pasted image 20230826171151.png]]
# CloudWatch
## Metrics
- provides metrics for every service
- 30 dimensions per metric
- metrics have timestamps
- can create dashboard and have custom metrics
### Streams
- continually stream metrics to a destination of your choice
- can filter
![[Pasted image 20230826181235.png]]
## Logs
- groups: usually representing an app
- stream: instances within app/ log files/ containers
- can define expiration
- can send to [[Scalable storage solutions|S3]], [[Data ingestion and transformation solutions|Kinesis]], [[Scalable and loosely coupled architectures|Lambda]], [[Data ingestion and transformation solutions|OpenSearch]]
- encrypted by default and can set up KMS
- can be exported to [[Scalable storage solutions|S3]]
	- not real time
- need to run CW agent on [[Scalable network architectures|EC2]] to push log files
### Sources
- SDK, CloudWatch Logs Agent, CloudWatch Unified Agent
- Elastic Beanstalk: collection of logs from application
- [[Scalable and loosely coupled architectures|ECS]]: collection from containers
- [[Scalable and loosely coupled architectures|Lambda]]: collection from function logs
- VPC Flow Logs: VPC specific logs
- API Gateway
- CloudTrail based on filter
- [[Highly available and fault tolerant architectures|Route 53]]: Log DNS queries
![[Pasted image 20230826181646.png]]
![[Pasted image 20230826181719.png]]
### Subscriptions
- real time log events for processing and analysis
- send to [[Data ingestion and transformation solutions|Kinesis]] or [[Scalable and loosely coupled architectures|Lambda]]
- can be multi account and multi region
![[Pasted image 20230826181915.png]]
## Unified Agent
- Collected directly on your Linux server / EC2 instance
- CPU (active, guest, idle, system, user, steal)
- Disk metrics (free, used, total), Disk IO (writes, reads, bytes, iops)
- RAM (free, inactive, used, total, cached)
- Netstat (number of TCP and UDP connections, net packets, bytes)
- Processes (total, dead, bloqued, idle, running, sleep)
- Swap Space (free, used, used %)
## Alarms
- to trigger notifications
- states: OK, INSUFFICIENT_DATA, ALARM
- 10s, 30s or multiples of 60s
### Targets
- EC2 terminate, reboot, or recover
- trigger auto scaling action
- [[Scalable and loosely coupled architectures|SNS]]
### Composite Alarms
- AND and OR conditions
![[Pasted image 20230826182453.png]]
## Container Insights
- collect, aggregate summarize metrics and logs from containers
- available for [[Scalable and loosely coupled architectures|ECS]], [[Scalable and loosely coupled architectures|EKS]], [[Scalable and loosely coupled architectures|Fargate]]
## Lambda Insights
- monitor and troubleshoot apps on [[Scalable and loosely coupled architectures|Lambda]]
- collects, summarizes and aggregates system level metrics and diagnostics
## Contributor Insights
- analyze log data and create time series that display contributor data
	- see metrics of the top N contributors
- helps find top talkers and understand who or what is impacting performance
## Application Insights
- automated dashboard to show potential problems with monitored apps and isolate ongoing issues
- powered by SageMaker
# EventBridge
- schedule [[Scalable and loosely coupled architectures|Lambda]]
- event rules to react to a service doing something
![[Pasted image 20230826182721.png]]
## Schema Registry
- analyze events in bus and infer the schema
- allows to generate code for your app that will know in advance how the data is structured in the event bus
- schema can be versioned
## Security
- when a rule runs, it needs permissions on the target
- resource-based policy: [[Scalable and loosely coupled architectures|Lambda]], [[Scalable and loosely coupled architectures|SNS]], [[Scalable and loosely coupled architectures|SQS]], [[Scalable and loosely coupled architectures|CloudWatch]] Logs, [[Scalable and loosely coupled architectures|API Gateway]]
- IAM role: [[Data ingestion and transformation solutions|Kinesis]] stream, Systems manager, [[Scalable and loosely coupled architectures|ECS]] task
# CloudTrail
- Provides governance, compliance and audit for your AWS Account
- Get an history of events / API calls made within your AWS Account by:
	- Console
	- SDK
	- CLI
	- AWS Services
- can put into CloudWatch Logs or [[Scalable storage solutions|S3]]
- can be applied to all regions or a single region
![[Pasted image 20230826183549.png]]
## Events
- retained for 90 days
- send to [[Scalable storage solutions|S3]] to keep beyond this
### Management
- operations that are performed on resources in your account
### Data
- by default, data events are not logged
- [[Scalable storage solutions|S3]] object level security
- [[Scalable and loosely coupled architectures|Lambda]] function execution
## Insights
- detect unusual activity in your account
- analyzes normal events to create baseline then continuously analyzes write events to detect unusual patterns
- sent to [[Scalable storage solutions|S3]]
- [[Scalable and loosely coupled architectures|EventBridge]] event is generated for automation needs
# Config
- helps with auditing and recording compliance of your resources
- Questions that can be solved by AWS Config:
	- Is there unrestricted SSH access to my security groups?
	- Do my buckets have any public access?
	- How has my ALB configuration changed over time?
- receive [[Scalable and loosely coupled architectures|SNS]] notifications
- per region service
- aggregated across regions and accounts
- can store in [[Scalable storage solutions|S3]]
## Rules
- managed and custom rules available
- can be evaluated/ triggered per change or at regular time intervals
- **does not prevent action from happening**
![[Pasted image 20230826184519.png]]
### Remediations
- can automate remediation of non-compliance using SSM automation
- can set remediation retries